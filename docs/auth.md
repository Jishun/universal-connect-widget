# Authentication layer

* It is considerred that the open source widget may be hosted and consumed within one secured domain, or maybe embeded from another domain, therefore, a token based session authentication is necessary.

* The widget is caplable of routing traffics to different providers, as well as handling multiple clients' requests(when hosted by a provider). it is un-avoid-able that there are going to be complications on secret management: each client will need their own registered api credentials per each provider they chose, the widget need to be able to identify the client and select the proper set of secrets, 
Therefore this is not proper to hard-configure the credentials into the widget server, to solve this problem. the provider specific credentials are offloaded to the clients through auth process, a `secret exchange` flow is used during authentication to manage the secrets:
  1. The client web server (which integrates/embeds the widget) stores their own provider credentials 
  2. On a user request to load the widget, and auth token is required, at this stage, the auth server takes an additional `secret-exchange payload` while generating the token, the `secret-exchange payload` is the encrypted credential collection, the encryption is done by the client server that uses a auth-service-pre-stored key plus an additional one time IV that is not knowing by the auth-service, the auth-servie responses with the Auth token, that is valid for a period, it's used to identify the client as well as being the key to locate the temporary stored credentials.
  3. the above step stores the secret into the auth-service for the period of the auth token validaty, while the auth server itself is unable to decode it due to missing the one time IV, the client then use the auth token as well as the one time encryption IV as the auth phraze to form the widget url.
  4. Once the request reaches the widget, the widget will talk to auth service to identify the user session, get user's encryption key and retrieves the encrypted credentials, the widget then is able to decode the credentials as it now has the key and the one time IV and the payload, then it makes the credential available and only available to this particular user session, this ensures the minimal access to the credentials, and only available for a short period in the widget server memory.